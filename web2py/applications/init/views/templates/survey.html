{{import urllib}}
{{import pydal.objects}}
{{from collections import OrderedDict}}
{{left_sidebar_enabled,right_sidebar_enabled=True,False}}
{{extend 'layout.html'}}

{{block head}}
    {{super}}
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css"/>

    <style>
        #web2py-logo {
           color: #BA55D3;
           text-shadow: 2px 2px #000000;
        }
        .web2py-menu-active {
            background-color: #BA55D3;
        }
    </style>
{{end}}

{{block header}}
<header style="text-align: center; padding-bottom:1px;">
    {{# <h3>A. Spencer MD (MDLand)</h3>  {{#practice}}
    <h3>Ebony Proudfoot <span class="text-muted">(Your Trainer)</span></h3>  {{#practice}}
    <h4><span class="glyphicon glyphicon-map-marker"></span> <a href="http://maps.google.com/?q={{=urllib.urlencode({'q':'660 White Plains Rd #325, Tarrytown, NY 10573'})}}">660 White Plains Rd #325, Tarrytown, NY 10573</a></h4>  {{#address}} {{# http://bit.ly/2a59inp}}
    <h5>
    <span class="glyphicon glyphicon-earphone"></span> (914) 524-0500 <span style="opacity:0.2">|</span>
    <span class="glyphicon glyphicon-print"></span> (914) 524-0501 <span style="opacity:0.2">|</span>
    {{# <span class="glyphicon glyphicon-envelope"></span> <a href="mailto:allison@insightmanagement.org">allison@insightmanagement.org</a>}}
    <span class="glyphicon glyphicon-envelope"></span> <a href="mailto:ebony@insightmanagement.org">ebony@insightmanagement.org</a>
    </h5>
</header>
{{end}}

{{block left_sidebar}}
<ul class="nav nav-pills nav-stacked">
    {{_pcmh_info = {
        "1":"abc",
        "2":"abcd",
    } }}
    {{_pcmh = request.controller}}
    {{_element = request.function}}
    {{if _pcmh in "123456":}}
        {{for l in _pcmh_info[_pcmh]:}}
            <li role="presentation" {{if _element==l:}}class="active"{{pass}}><a href="{{=URL(_pcmh, l, vars=request.vars)}}">Element {{=l.upper()}}</a></li>
        {{pass}}
    {{else:}}
        <li role="presentation" {{if request.function == "practice":}}class="active"{{pass}}><a href="{{=URL('0', 'practice', vars=request.vars)}}">Practice</a></li>
        <li role="presentation" {{if request.function == "staff":}}class="active"{{pass}}><a href="{{=URL('0', 'staff', vars=request.vars)}}">Staff</a></li>
        <li role="presentation" {{if request.function == "emr":}}class="active"{{pass}}><a href="{{=URL('0', 'emr', vars=request.vars)}}">EMR</a></li>
        <li role="presentation"><a href="#">Credentials</a></li>
        <li role="presentation"><a href="#">NCQA</a></li>  {{# credit card http://stackoverflow.com/questions/1146810/taking-credit-card-information-online-without-processing-how-best-to-do-so}}
    {{pass}}
</ul>
{{end}}

{{def QUESTION_PANEL(qna):}}
{{if qna.show:}}
<div id="{{=qna.table_name}}" class="panel panel-{{if qna.needs_answer():}}primary{{else:}}info{{pass}}">
    <div class="panel-heading question-box-heading"><span class="pull-right glyphicon glyphicon-{{if not qna.needs_answer():}}check{{else:}}unchecked{{pass}}"></span><span class="question-box-title-done">{{if qna.needs_answer():}}[Needs Answer]{{else:}}[Answered]{{pass}} {{=qna.question}}</span></div>
    <div class="panel-body">
    {{for warning in qna.warnings:}}
        <blockquote class="text-danger">{{=warning}}</blockquote>
    {{pass}}
    {{if qna.rows:}}
        <h5>
        {{_bullet="ul" if qna.limit==1 else "ol"}}
        {{=XML("<"+_bullet+">")}}
        {{for rendered in qna.render_template():}}
            <li>{{=rendered}}</li>
        {{pass}}
        {{=XML("</"+_bullet+">")}}
        </h5>
        <br>
    {{pass}}
    {{=qna.form}}
    {{=qna.clear_button}}
    </div>
</div>
{{pass}}
{{return}}

{{
        actions = []
        show_generic = False
        if any(map(lambda e: e.needs_answer(), QNA.instances)):
            actions.append(XML(T("Please <b class='text-warning'>answer</b> one or more questions below.")))
        pass
        if any(map(lambda e: e.has_warnings(), QNA.instances)):
            actions.append(XML(T("Please <b class='text-danger'>resolve</b> one or more questions below.")))
        pass
        if actions:
            actions.append(XML(T("If you feel stuck at any point, please contact your trainer above.")))
        pass
        has_action = bool(actions)
}}

<div class="panel panel-primary panel-{{if has_action:}}danger{{else:}}success{{pass}}">
    <div class="panel-heading question-box-heading" style="text-transform: none; font-size:17px"><span class="pull-right glyphicon glyphicon-{{if not has_action:}}ok-sign{{else:}}exclamation-sign{{pass}}"></span>{{if has_action:}}Action{{="s" if len(actions)>1 else ""}} needed...{{else:}}Success!{{pass}}</div>
    <div class="panel-body">
        <ul>
            {{for action in actions:}}
                <li>{{=action}}</li>
            {{pass}}
            {{if not has_action:}}
                <li>You have completed this section!</li>
                {{for doc in documents:}}
                    <li>Download <a href="{{=doc[1]}}">{{=doc[0]}}</a></li>
                {{pass}}
            {{pass}}
        </ul>
    </div>
</div>

{{include}}

{{block right_sidebar}}
{{end}}

{{block page_js}}
{{super}}
    <script>
        $(".panel-body").each(function(){
            $(this).hide();
            $(this).fadeIn(500);
        })
    </script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("[multiple='multiple']").multiselect();
        });
    </script>
{{end page_js}}